name: ground

services:
  influxdb:
    container_name: influxdb
    image: influxdb:2
    restart: unless-stopped
    environment:
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=${DOCKER_DATABASE__ADMIN_USER}
      - DOCKER_INFLUXDB_INIT_PASSWORD=${DOCKER_DATABASE__ADMIN_PASSWORD}
      - DOCKER_INFLUXDB_INIT_ORG=${DATABASE__ORG}
      - DOCKER_INFLUXDB_INIT_BUCKET=${DATABASE__BUCKET}
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${DATABASE__TOKEN}
    volumes:
      - type: volume
        source: influxdb-data
        target: /var/lib/influxdb2
      - type: volume
        source: influxdb-config
        target: /etc/influxdb2
    ports:
      - "8086:8086"

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    restart: unless-stopped
    environment:
      - GF_SERVER_ROOT_URL=http://ground.local/
      - GF_PLUGINS_PREINSTALL=grafana-clock-panel
    ports:
      - '3000:3000'
    volumes:
      - 'grafana_storage:/var/lib/grafana'
volumes:
  grafana_storage:
  influxdb-data:
  influxdb-config:
